<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Title Page</title>

    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
</head>
<style>
    html,
    body {
        height: 100%;
    }

    * {
        margin: 0;
        padding: 0;
    }
	table{  
        width: 100%;
        border-width: 1px;
        border-color: #000;
        border-collapse: collapse;
    } 
    table.tftable tr {
        background-color: #ffffff;
    } 
    td {
	    text-align:center;
        font-size: 12px;
        border-width: 1px;
        padding:0;
        border-style: solid;
        border-color: #000;
		height: 36px;
        overflow: hidden;
    }
	.top{    display: flex;
    justify-content: center;
    margin: 20px;}
    .addBackground {
        background-color: red;
    }

    .rightclick {
        display: none;
        width: 100px;
        height: 30px;
        border-width: 1px 1px 0 1px;
        border-style: solid;
        border-color: black;
        background-color: rgba(242, 242, 242, 0.6);
        border-radius: 4px;
        position: fixed;
        left: 0;
        top: 0;
    }

    .rightclick ul {
        list-style: none;
        cursor: pointer;

    }

    .rightclick ul li {
        text-align: center;
        font-family: "微软雅黑";
        height: 30px;
        line-height: 30px;
        border-bottom: 1px solid #666;
    }
	#s{width: 100%; height: 300px;}
</style>
<!-- jQuery -->
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<!-- Bootstrap JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<body>
	<div class="container" id="app">
		<div class="rightclick" id="rightclick">
			<ul>
				<li id="heBing">合并</li>
			</ul>
		</div>
		<div class="top">
		行数:<input type="text" class='row' value='9'>
		列数:<input type="text" class='column' value='9'>
		<input type="button" value="确定" id="button">
		</div>
		<div id='table' style="margin:0 auto;"><table id='tableContent'></table>
		</div>
	</div>
	<div class="container" id="app">
		<button id="showCode">获取代码</button>
		<textarea id="s">
		
		</textarea>
	</div>
</body>
<script type="text/javascript">
	
    document.getElementById('app').oncontextmenu = function (e) {
        var ev = window.event || e;
        if (document.all) {
            ev.returnValue = false;    //ie阻止默认事件
        } else {
            ev.preventDefault();       //w3c阻止默认事件
        }
        var clientx = ev.clientX;
        var clienty = ev.clientY;
        var rightclick = document.getElementById("rightclick");
        rightclick.style.display = "block";
        rightclick.style.left = clientx + "px";
        rightclick.style.top = clienty + "px";
    }

    document.body.onmousedown = function () {
        document.getElementById("rightclick").style.display = "none";
    };

    document.getElementById("rightclick").onmousedown = function (e) {
        var ev = window.event || e;
        if (document.all) {
            ev.cancelBubble = true;     // ie阻止事件流
        } else {
            ev.stopPropagation();      // w3c阻止事件流
        }
    };


</script>
<script>
    topMostX = undefined;
    topMostY = undefined;
    buttomMostX = undefined;
    buttomMostY = undefined;
    num = 0
    function processingData() {
        topMostX = undefined;
        topMostY = undefined;
        buttomMostX = undefined;
        buttomMostY = undefined;
        num = $('.addBackground').length
        $('.addBackground').each(function (i, e) {
            var row = parseInt($('.addBackground').eq(i).data('row'))
            var column = parseInt($('.addBackground').eq(i).data('column'))
            if (topMostX == undefined) {
                topMostX = row
                topMostY = column
                buttomMostX = row;
                buttomMostY = column;
            } else {
                // 右小脚的坐标
                if (buttomMostX < row) {
                    buttomMostX = row;
                    buttomMostY = column;
                }
                if ((buttomMostX == row) && (column > buttomMostY)) {
                    buttomMostX = row;
                    buttomMostY = column;
                }

                //左上角的坐标
                if (topMostX > row) {
                    topMostX = row
                    topMostY = column
                }
                if ((topMostX == row) && (column < topMostY)) {
                    topMostX = row
                    topMostY = column
                }
            }
        })
        
    }

    $('#button').click(function () {
        var row = $('.row').val()
        var column = $('.column').val()
        if (!row || !column || row == 0 || column == 0) {
            alert('行或列不能为空')
        }

        var html = '';
        $('#tableContent').html('')
        for (rowIndex = 1; rowIndex <=row; rowIndex++) { //多少行
            html += "\n\t<tr>"
            for (let columnIndex = 1; columnIndex <= column; columnIndex++) {
                html += "\n\t\t<td data-row=\"" + rowIndex + "\" data-column=\"" + columnIndex + "\" >行" + rowIndex + "-列" + columnIndex + "</td>";
            }
            html += "\n\t</tr>";
        }
        $('#tableContent').append(html)
    })
    //添加背景色
    $("#table").on("click", "td", function () {
        if ($(this).hasClass("addBackground")) {
            $(this).removeClass('addBackground')
        } else {
            $(this).addClass('addBackground')
        }
        processingData()
    })
    //点击合并
    $('#heBing').click(function () {
        processingData()
        if (buttomMostY == topMostY) {
            num = buttomMostX - topMostX + 1;
        }

        if (buttomMostX == topMostX) {
            num = buttomMostY - topMostY + 1;
        }

        if ((buttomMostX != topMostX) && (buttomMostY != topMostY)) {
            num = ((buttomMostY - topMostY) + 1) * ((buttomMostX - topMostX) + 1)
        }
        if (parseInt($('.addBackground').length) != num) {
            alert(num)

            alert('合并单元格,格式不正确')
            return
        }

        if (buttomMostY == topMostY) {
            var num = buttomMostX - topMostX + 1
            $('tr').eq(topMostX - 1).find('td').eq(topMostY - 1).attr('rowspan', num)
            for (let index = topMostX + 1; index <= buttomMostX; index++) {
                $('tr').eq(index - 1).find('td').last().remove()
            }
        }


        if (buttomMostX == topMostX) {
            var num = buttomMostY - topMostY + 1
            $('tr').eq(topMostX - 1).find('td').eq(topMostY - 1).attr('colspan', num)
            for (let index = topMostY + 1; index <= buttomMostY; index++) {
                $('tr').eq(topMostX - 1).find('td').last().remove()
            }
        }

        $('.addBackground').removeClass('addBackground') 
    })
	$('#showCode').click(function(){ 
	    var h=$('#table').html(); 
		h=h.replace(/data-row=\"\d\"\sdata-column=\"\d\"/g,'');
		$('#s').val(h);
	})
</script>


</html>